# Hash

> 平时在java中，有用到HashMap等，在MySQL中也会涉及到Hash索引，现在的区块链技术的底层原理之一也是Hash，本文对Hash做一个记录。

## 什么是Hash

Hash，翻译为中文有哈希、散列、杂凑等，是指把任意长度的输入通过一定的算法变成**固定长度的输出**的过程，其是可以从任何一种数据中创建小的数字“指纹”的方法。

一个优秀的Hash算法具有以下几个特点：

+ **抗碰撞能力强**

  对应任意两个不同的数据块，hash值相同的概率极小。

+ **抗篡改能力强**

  对于一个数据块，哪怕只改动其一个比特位，其hash值的改动也会非常大。

+ **不能反向推导**

  因为Hash的输出是固定长度，所以输出是有限的，必然会存在不同的输入得到相同输出的情况，所以Hash算法是不能反向推导出原始数据的。

+ **执行高效**

  长的文本也能快速地计算出哈希值。

## Hash碰撞

由于Hash函数产生的Hash值是有限的，必然会存在不同的输入得到相同输出的情况，这就是所谓的Hash碰撞，也称为Hash冲突。

### 解决方法

解决哈希冲突的方法一般有：开放定址法、链地址法（拉链法）、再哈希法、建立公共溢出区等方法。

#### 开放地址法

开放地址法是指从冲突的那个单元起，按照一定次序从哈希表中找到一个空闲的单位，然后把冲突的元素存入到该单元，**所以开放定址法需要的表长度要大于等于所需要存放的元素**。

开放地址法主要包括线行探查法、平方探查法、双散列函数探查法。

+ **线行探查法**

  线性探查法是指从发生冲突的单元起，依次判断下个单元是否为空，为空则插入；当达到最后一个单元时在从表首依次判断。

  不过该方法若是反复插入同一个槽，则会存在太多重复操作。

  比如对于下图所示情况，哈希表长为6，首先插入8，由于8%6=2，故应插入第3个槽中，由于第3个槽有值则判断下一个单位并插入，不过对于数据13的插入，则需要判断3次，效率太低。

  ![线性探测法1](data\线性探测法1.png)

  ![线性探测法2](data\线性探测法2.png)

+ **平方探查法**

  平方探查法是指在发生冲突初依次加入1的平方，随之是2的平方，3的平方，直至不发生冲突，该方法主要用于解决线性探查法的集聚问题。

+ **伪随机探查法**

  通过随机函数随机生成一个数，在原来值的基础上加上随机数，直至不发生哈希冲突。

#### 链地址法（拉链法）

如下图所示，链接地址法的思路是将哈希值相同的元素构成一个同义词的单链表，并将单链表的头指针存放在哈希表的第i个单元中，查找、插入和删除主要在同义词链表中进行。链表法适用于经常进行插入和删除的情况。

Java中的HashMap就是采用的该方式解决Hash冲突，在java8之后，链表长度大于8之后，会转换为红黑树存储。在jdk1.8之前是使用的头插法，在jdk1.8中是尾插法。

![链地址法](data\链地址法.png)

#### 再哈希法

再哈希法是指构造多个哈希函数，当H1发生冲突时，采用H2进行计算，直到不再发生冲突。这种方法不易产生聚集，但是增加了计算时间。

#### 建立公共溢出区

将哈希表分为公共表和溢出表，当溢出发生时，将所有溢出数据统一放到溢出区。

## Hash的应用

Hash主要应用在数据结构中以及密码学中，其主要的应用有如下几个方面：

### 信息加密

服务端保存用户的密码时需要对密码进行Hash加密，不然很容易被黑客窃取数据来登录，最简单的加密方法就是直接使用MD5加密，不过此方法也很容易被反向查询出来。

针对这种问题，解决方法就是"**加盐**"，即利用盐与用户密码组合进行加密，增加了反向查询的复杂度。

### 唯一标识

对大数据做信息摘要，通过一个较短的二进制编码来表示。

### 数据校验

校验数据的完整性和正确性。

在进行BT下载时，会将文件分成多个文件块，并行下载后再进行组装，可以对文件块去Hash值，下载完成后再将文件块中的Hash值进行比对。

### 负载均衡

对客户端IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号。

这样，我们就可以把同一个 IP 过来的所有请求，都路由到同一个后端服务器上。

### 分布式存储

面对海量数据，为了提高数据的读取、写入能力，一般都采用分布式的方式来存储数据，比如分布式缓存。借用前面数据分片的思想，即通过哈希算法对数据取哈希值，然后对机器个数取模，这个最终值就是应该存储的缓存机器编号。

但是，后期如果需要新增或者下线个数发生改变，会造成缓存数据全部失效，解决这个问题，就需要**一致性哈希算法**。

## 一致性哈希算法



## 引用

[散列函數](https://www.zhihu.com/question/26762707/answer/890181997 )

[关于哈希的一切！](https://segmentfault.com/a/1190000023872036)

什么是 hash？ - 之幽的回答 - 知乎 https://www.zhihu.com/question/26762707/answer/40119521

什么是 hash？ - 腾讯技术工程的回答 - 知乎 https://www.zhihu.com/question/26762707/answer/890181997

[解决哈希冲突的常用方法分析](https://www.jianshu.com/p/4d3cb99d7580)

[【算法】理解哈希算法 hash 和常见应用](https://blog.csdn.net/sscc_learning/article/details/88658511)

聊聊一致性哈希 - 刘梦馨的文章 - 知乎 https://zhuanlan.zhihu.com/p/24440059

[一致性Hash在负载均衡中的应用](https://juejin.cn/post/6844903670430040078)