# HTTP基础

## HTTP消息

HTTP消息包括客户端向服务器的请求消息和服务器向客户端的响应消息。客户端向服务器发送一个请求，请求头包含请求的方法、URI、协议版本、以及包含请求修饰符、客户信息和内容的类似于MIME的消息结构。服务器以一个状态行作为响应，相应的内容包括消息协议的版本，成功或者错误编码加上包含服务器信息、实体元信息以及可能的实体内容。

## HTTP头信息

HTTP的头域包括通用头，请求头，响应头和实体头四个部分。

### HTTP通用头

客户端和服务端都可以使用的头部，提供有用的通用信息。

+ Cache-Control：指定请求和响应遵循的缓存机制。
  + no-cache：如果no-cache没有指定值，那就表示不允许缓存。对于请求来说，服务器不得使用缓存内容直接返回。对于响应来说，客户端不得缓存响应的资源内容。如果no-cache指定了值，那就表示值对应的头信息不得使用缓存，其它的信息还是可以缓存的。
  + no-store：不要持久化请求/响应数据到其它地方，因为其中可能会包含敏感信息。
  + no-transform：告知对方不要转换数据。比如客户端上传了raw图像数据，服务器一般都会选择性压缩图像数据进行存储。no-transform告知对方保留原始数据信息，不要进行任何转换。
  + max-age：用于请求头，限制缓存年龄，如果超过需要max-age，需要服务器去reload。
  + max-stale：用于请求头，允许服务端返回缓存过期的资源，但限定了最大过期时间（**增加缓存时间**）。
  + min-fresh：用于请求头，限制服务端返回即将过期的资源（**缩短缓存时间**）。
  + only-if-cached：用于请求头，告知服务器只要那些已经缓存的内容，不要去reload，如果没有缓存内容就返回504 Gateway Timeout错误。
  + public：用于响应头，允许客户端缓存响应信息，并给别人使用，如代理服务器缓存静态资源给代理用户使用。
  + private：用于响应头，允许客户端缓存响应信息，但禁止给别人使用。

+ Pragma：在开发模式经常用到，防止静态资源修改后前端得不到即时更新。
+ Connection：表示是否需要持久连接。
  + Close：完成本次请求的响应后，断开连接。
  + Keepalive：完成本次请求响应后，保持连接并等待后续请求。
  + Keep-Alive：表示保持连接等待时间（秒），如```Keep-Alive:300```。
+ Date：如果服务器没有缓存，那么Date就是响应的即时生成时间。如果服务器设有缓存，那么Date就是响应内容被缓存的时间。
+ Transfer-Encoding：传送Body信息时需要对Body数据采取何种变换。比如是否分块(chunked)，```Transfer-Encoding:  chunked```
+ Upgrade：服务器建议客户端升级传输协议。
+ Via：该字段用来标识一个请求经过的网关路由节点。如果这个请求经过了多个代理层，Via头部就会有多个网关信息。

### HTTP请求头

请求报文特有的，为服务器提供一些额外信息，如是谁或者什么在发送，请求来自何处或者客户端的喜好及能力等。

+ Accept：告诉WEB服务器自己接受的介质类型，```/``` 表示任何类型，```type/*``` 表示该类型下的所有子类型，```text/html```浏览器可以接受服务器回发的类型为 text/html。
+ Accept-Charset：告诉服务器能接收的字符集，如```Accept-Charset: utf8, gbk; q=0.6```，q表示优先级，优先使用utf8，不行再使用gbk。
+ Accept-Encoding：客户端指定接收的编码方法，通常是指定压缩方法，如```Accept-Encoding: gzip, deflate```。
+ Accept-Language：客户端指定接收的语言，如```Accept-Language:zh-CN,en-US;q=0.8,zh-TW;q=0.6```。
+ Authorization：用于回应自己身份信息给服务端。
+ If-Match：是指如果对象的 ETag （ETag定义见下文实体头中）没有改变，才执行请求的动作。客户端先GET这个资源得到ETag中的版本号，然后发起一个资源修改请求PUT|PATCH时通过If-Match头来指定资源的版本号，如果服务器资源满足If-Match中指定的版本号，请求就会被执行。如果不满足，说明资源被并发修改了，就需要返回状态码为412 Precondition failed 的错误。客户端可以选择放弃或者重试整个过程。

+ If-None-Match：是指如果对象的 ETag改变，才执行请求的动作。
+ If-Modified-Since：如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作(比如返回对象)，否则返回代码304，告诉浏览器该对象没有修改。
+ If-Unmodified-Since：如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作(比如返回对象)。
+ If-Range：在断点续传时，为确保连续2个请求之间服务器资源本身没有发生变化，需要If-Range头带上ETag的资源版本号。服务器资源根据这个版本号来判定资源是否改变了。如果没变，就返回206 Partial Content将部分资源返回。如果资源变了，那就相当于一个普通的GET请求，返回200 OK和整个资源内容。
+ Range：支持断点续传的服务器必须处理Range头，它表示客户端请求资源的一部分时指定的请求字节范围，表示自己想取对象的哪部分，如```Range: bytes=500-999```。
+ Proxy-Authenticate：代理服务器响应浏览器，要求其提供代理身份验证信息。
+ Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。
+ Host：客户端指定自己想访问的WEB服务器的域名和端口号，如```Host: www.baidu.com```。
+ Referer：客户端向服务端表明自己是从哪个网页URL跳转指当前的网页，也就是当前页面资源的父页面。如果你从A页面跳转到B页面，那么请求B页面的请求头里面就会有Referer信息，它的值就是A页面的访问地址。通过追踪Referer，可得出资源页面之间复杂的跳转链，它非常适合用于网页的数据分析和路径优化。
+ User-Agent：携带当前的用户代理信息，一般包含浏览器、浏览器内核和操作系统的版本型号信息，如```User-Agent：Mozilla/5.0 (Windows; U; Windows NT 5.1;  zh-CN;rv:1.8.1.14) Gecko/20080404 Firefox/2.0.0.14```。
+ Cookie：Cookie是用来存储一些用户信息以便让服务器辨别用户身份的（大多数需要登录的网站上面会比较常见），比如cookie会存储一些用户的用户名和密码，当用户登录后就会在客户端产生一个cookie来存储相关信息，这样浏览器通过读取cookie的信息去服务器上验证并通过后会判定你是合法用户，从而允许查看相应网页。当然cookie里面的数据不仅仅是上述范围，还有很多信息可以存储是cookie里面，比如sessionid等。

### HTTP响应头

用于客户端提供一些额外信息，比如谁在发送响应，响应者的功能或者与响应相关的特殊功能等。

+ Age：资源的年龄，单位为秒。
+ Server：返回服务器相关的软件信息，表明自己是什么软件和版本信息，如```Server：Apache/2.0.61 (Unix)```。
+ Accept-Ranges：服务器表明自己是否接受获取其某个实体的一部分(比如文件的一部分)的请求。bytes：表示接受，none：表示不接受。
+ Vary：用于缓存控制，如```Vary: Accept-Encoding,Accept-Language```告知缓存服务器对不同语言和编码使用不同的缓存单元。

### HTTP实体头

实体头部提供了有关实体及其内容的大量信息，从有关对象类型的信息，到能够对资源使用的各种有效的请求方法。总之，实体头部可以告知接收者它在对什么进行处理。请求消息和响应消息都可以包含实体信息，实体信息一般由实体头域和实体组成。

+ Allow：服务器支持哪些请求方法(如GET、POST等)。
+ Location：服务器向客户端发送302跳转的时候，总会携带Location头信息，它的值为目标URL。
+ Content-Base：解析主体中的相对URL时使用的基础URL。
+ Content-Encoding：服务端表明自己用什么压缩方法（gzip，deflate）压缩响应中的对象。
+ Content-Language：服务器告诉浏览器返回的Body信息的语言是什么。该字段内容是对Accept-Language的应答。
+ Content-Length：表示传输的请求／响应的Body的长度。
+ Content-Location：资源所处位置。
+ Content-MD5：主体的MD5校验和。
+ Content-Range：针对上面的Range头，服务器响应客户端时也需提供相应的Content-Range头，表示传输的Body数据在整体资源块中的字节范围。如```Content-Range: bytes 21010-47021/47022```是指资源总共47022字节，当前响应的内容是21010-47021字节之间的内容。
+ Content-Type：服务端告诉客户端响应的对象类型，如```Content-Type：application/xml```。
+ ETag：一个对象的标志位，一般携带的是资源的版本号。
+ Expires：表示实体将在什么时候过期。
+ Last-Modified：对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。

## HTTP返回错误吗

+ 1XX：信息，收到请求，继续处理。
+ 2XX：成功。
+ 3XX：重定向，为了完成请求必须进一步执行的动作。
+ 4XX：客户端错误。
+ 5XX：服务端错误。